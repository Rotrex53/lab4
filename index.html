<!DOCTYPE html>
<html lang="en" data-color-mode="auto" data-light-theme="light" data-dark-theme="dark" data-a11y-animated-images="system" data-a11y-link-underlines="true">
  <head>
    <meta charset="utf-8">
    <link rel="dns-prefetch" href="https://github.githubassets.com">
    <link rel="dns-prefetch" href="https://avatars.githubusercontent.com">
    <link rel="dns-prefetch" href="https://github-cloud.s3.amazonaws.com">
    <link rel="dns-prefetch" href="https://user-images.githubusercontent.com/">
    <link rel="preconnect" href="https://github.githubassets.com" crossorigin>
    <link rel="preconnect" href="https://avatars.githubusercontent.com">
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/light-8e973f836952.css" />
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/dark-4bce7af39e21.css" />
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/primer-primitives-c37d781e2da5.css" />
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/primer-efa08b71f947.css" />
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/global-6dcb16809e76.css" />
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/github-f86c648606b5.css" />
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/repository-5d735668c600.css" />
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="https://github.githubassets.com/assets/code-9c9b8dc61e74.css" />
    
    <title>IISSI1-IS-2025/laboratorio-4-data-query-language</title>
    <meta name="viewport" content="width=device-width">
    <link rel="icon" class="js-site-favicon" type="image/svg+xml" href="https://github.githubassets.com/favicons/favicon.svg">
    <meta name="theme-color" content="#1e2327">
  </head>

  <body class="logged-in env-production page-responsive" style="word-wrap: break-word;">
    <div data-turbo-body class="logged-in env-production page-responsive" style="word-wrap: break-word;">
      
      <div class="position-relative header-wrapper js-header-wrapper ">
        <header class="AppHeader" role="banner">
          <div class="AppHeader-globalBar pb-2 js-global-bar">
            <div class="AppHeader-globalBar-start responsive-context-region">
              <a class="AppHeader-logo ml-1" href="https://github.com/">
                <svg height="32" aria-hidden="true" viewBox="0 0 24 24" version="1.1" width="32" data-view-component="true" class="octicon octicon-mark-github v-align-middle">
                  <path d="M12 1C5.923 1 1 5.923 1 12c0 4.867 3.149 8.979 7.521 10.436.55.096.756-.233.756-.522 0-.262-.013-1.128-.013-2.049-2.764.509-3.479-.674-3.699-1.292-.124-.317-.66-1.293-1.127-1.554-.385-.207-.936-.715-.014-.729.866-.014 1.485.797 1.691 1.128.99 1.663 2.571 1.196 3.204.907.096-.715.385-1.196.701-1.471-2.448-.275-5.005-1.224-5.005-5.432 0-1.196.426-2.186 1.128-2.956-.111-.275-.496-1.402.11-2.915 0 0 .921-.288 3.024 1.128a10.193 10.193 0 0 1 2.75-.371c.936 0 1.871.123 2.75.371 2.104-1.43 3.025-1.128 3.025-1.128.605 1.513.221 2.64.111 2.915.701.77 1.127 1.747 1.127 2.956 0 4.222-2.571 5.157-5.019 5.432.399.344.743 1.004.743 2.035 0 1.471-.014 2.654-.014 3.025 0 .289.206.632.756.522C19.851 20.979 23 16.854 23 12c0-6.077-4.922-11-11-11Z"></path>
                </svg>
              </a>
              <div class="AppHeader-context-full">
                <nav role="navigation" aria-label="GitHub Breadcrumb">
                  <ol class="list-style-none d-flex">
                    <li class="AppHeader-context-item">
                      <span class="AppHeader-context-item-label">IISSI1-IS-2025</span>
                      <span class="AppHeader-context-item-separator">/</span>
                    </li>
                    <li class="AppHeader-context-item">
                      <span class="AppHeader-context-item-label">laboratorio-4-data-query-language</span>
                    </li>
                  </ol>
                </nav>
              </div>
            </div>

            <div class="AppHeader-globalBar-end">
                <div class="AppHeader-search">
                    <div class="search-input-container">
                        <button type="button" class="AppHeader-searchButton form-control text-left color-fg-subtle no-wrap">
                            Type <kbd class="AppHeader-search-kbd">/</kbd> to search
                        </button>
                    </div>
                </div>

                <div class="AppHeader-button-wrapper" style="margin-right: 8px;">
                    <button id="AppHeader-upload-button" type="button" onclick="toggleModal(true)" class="Button Button--iconOnly Button--secondary Button--medium AppHeader-button color-fg-muted">
                        <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-upload Button-visual">
                            <path d="M2.75 14A1.75 1.75 0 0 1 1 12.25v-2.5a.75.75 0 0 1 1.5 0v2.5c0 .138.112.25.25.25h10.5a.25.25 0 0 0 .25-.25v-2.5a.75.75 0 0 1 1.5 0v2.5A1.75 1.75 0 0 1 13.25 14Z"></path>
                            <path d="M11.78 4.78a.75.75 0 0 1-1.06 0L8.75 2.81v7.44a.75.75 0 0 1-1.5 0V2.81L5.28 4.78a.75.75 0 0 1-1.06-1.06l3.25-3.25a.75.75 0 0 1 1.06 0l3.25 3.25a.75.75 0 0 1 0 1.06Z"></path>
                        </svg>
                    </button>
                </div>

                <div class="AppHeader-user">
                    <button type="button" class="Button--invisible Button--medium Button p-0">
                        <img src="https://avatars.githubusercontent.com/u/208998238?v=4" alt="" size="32" height="32" width="32" class="avatar circle" />
                    </button>
                </div>
            </div>
          </div>
        </header>
      </div>

      <div class="application-main">
        <main id="js-repo-pjax-container">
          <div class="container-xl px-3 px-md-4 px-lg-5">
            <div class="Layout Layout--sidebarPosition-end">
              <div class="Layout-main">
                <div class="Box">
                  <div class="Box-header">
                    <h2 class="Box-title">README.md</h2>
                  </div>
                  <div class="Box-body">
                    <article class="markdown-body entry-content container-lg" itemprop="text">
                        <h1>Lab4: Data Query Language</h1>
                        <p>Partiendo de la base de datos <code>tiendaOnline</code> e insertando datos, diseñe las consultas SQL que respondan a los siguientes ejercicios.</p>
                        
                        <h3>1. Consultas básicas de selección</h3>
                        <details>
                            <summary><b>Lista todos los usuarios en la tabla `Usuarios`, mostrando solo sus nombres y correos electrónicos.</b></summary>
                            <pre>SELECT nombre, email FROM Usuarios;</pre>
                        </details>
                        <details>
                            <summary><b>Muestra los empleados con su salario y el nombre correspondiente en la tabla `Usuarios`.</b></summary>
                            <pre>SELECT Usuarios.nombre, Empleados.salario FROM Empleados JOIN Usuarios ON Empleados.usuarioId = Usuarios.id;</pre>
                        </details>

                        <h3>2. Consultas con condiciones específicas</h3>
                        <details>
                            <summary><b>Encuentra el salario promedio de los empleados.</b></summary>
                            <pre>SELECT AVG(salario) AS salario_promedio FROM Empleados;</pre>
                        </details>
                        
                        </article>
                  </div>
                </div>
              </div>
              
              <div class="Layout-sidebar">
                <div class="BorderGrid">
                    <div class="BorderGrid-row">
                        <div class="BorderGrid-cell">
                            <h2 class="h4 mb-3">About</h2>
                            <p class="f4 my-3 color-fg-muted text-italic">No description, website, or topics provided.</p>
                            <div class="mt-2">
                                <a href="#" class="Link--muted"><svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" class="octicon octicon-book mr-2"><path d="M0 1.75A.75.75 0 0 1 .75 1h4.253c1.227 0 2.317.59 3 1.501A3.743 3.743 0 0 1 11.006 1h4.245a.75.75 0 0 1 .75.75v10.5a.75.75 0 0 1-.75.75h-4.507a2.25 2.25 0 0 0-1.591.659l-.622.621a.75.75 0 0 1-1.06 0l-.622-.621A2.25 2.25 0 0 0 5.258 13H.75a.75.75 0 0 1-.75-.75Zm7.251 10.324.004-5.073-.002-2.253A2.25 2.25 0 0 0 5.003 2.5H1.5v9h3.757a3.75 3.75 0 0 1 1.994.574ZM8.755 4.75l-.004 7.322a3.752 3.752 0 0 1 1.992-.572H14.5v-9h-3.495a2.25 2.25 0 0 0-2.25 2.25Z"></path></svg>Readme</a>
                            </div>
                        </div>
                    </div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <style>
        .custom-modal-overlay {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(2px);
        }
    
        .custom-modal-box {
            background-color: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            width: 450px;
            padding: 0;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            color: #c9d1d9;
        }
    
        .custom-modal-header {
            background-color: #161b22;
            padding: 16px;
            border-bottom: 1px solid #30363d;
            border-radius: 6px 6px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    
        .custom-modal-header h3 { margin: 0; font-size: 14px; font-weight: 600; color: #c9d1d9; }
        
        .custom-close-btn { background: none; border: none; color: #8b949e; cursor: pointer; font-size: 16px; }
        .custom-close-btn:hover { color: #58a6ff; }
    
        .custom-modal-body { padding: 20px; }
    
        .gh-input {
            width: 100%;
            background-color: #0d1117;
            border: 1px solid #30363d;
            color: #c9d1d9;
            padding: 5px 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 14px;
            line-height: 20px;
            box-sizing: border-box;
        }
        .gh-input:focus { border-color: #58a6ff; outline: none; box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.3); }
    
        .gh-label { display: block; font-weight: 600; font-size: 14px; margin-bottom: 6px; color: #c9d1d9; }
    
        .gh-btn-primary {
            background-color: #238636;
            color: white;
            border: 1px solid rgba(240,246,252,0.1);
            border-radius: 6px;
            padding: 5px 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
        }
        .gh-btn-primary:hover { background-color: #2ea043; }
    </style>
    
    <div id="uploadModal" class="custom-modal-overlay">
        <div class="custom-modal-box">
            <div class="custom-modal-header">
                <h3>Subir archivo y Procesar</h3>
                <button class="custom-close-btn" onclick="toggleModal(false)">✕</button>
            </div>
            <div class="custom-modal-body">
                <label class="gh-label">Tu API Key de Gemini</label>
                <input type="password" id="apiKeyInput" class="gh-input" placeholder="Pega aquí tu clave (AIzaSy...)" autocomplete="off">
                <p style="font-size: 11px; color: #8b949e; margin-top: -10px; margin-bottom: 15px;">
                    Se guardará en tu navegador localmente. No se comparte con nadie.
                </p>
    
                <label class="gh-label">Archivo</label>
                <input type="file" id="fileInput" class="gh-input" style="padding-left: 0;">
                
                <label class="gh-label">Descripción (Prompt)</label>
                <input type="text" id="descInput" class="gh-input" placeholder="Ej: Realiza los ejercicios del documento...">
                
                <button class="gh-btn-primary" onclick="handleMagicUpload()">Confirmar subida</button>
                <p id="uploadStatus" style="font-size: 12px; color: #8b949e; margin-top: 10px;"></p>
            </div>
        </div>
    </div>
    
    <script>
        // CONFIGURACIÓN
        const MODEL_NAME = "gemini-2.5-pro"; 
    
        // Al cargar la página, miramos si el usuario ya guardó su clave antes
        document.addEventListener('DOMContentLoaded', () => {
            const savedKey = localStorage.getItem('user_gemini_api_key');
            if (savedKey) {
                document.getElementById('apiKeyInput').value = savedKey;
            }
        });
    
        function toggleModal(show) {
            const modal = document.getElementById('uploadModal');
            if (modal) {
                modal.style.display = show ? 'flex' : 'none';
                if (!show) {
                    // Limpiar mensajes
                    document.getElementById('uploadStatus').textContent = "";
                    document.getElementById('fileInput').value = "";
                    document.getElementById('descInput').value = "";
                }
            }
        }
    
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64String = reader.result.split(',')[1]; 
                    resolve(base64String);
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
    
        async function handleMagicUpload() {
            const fileInput = document.getElementById('fileInput');
            const descInput = document.getElementById('descInput').value;
            const apiKeyInput = document.getElementById('apiKeyInput').value.trim();
            const status = document.getElementById('uploadStatus');
    
            // 1. VALIDACIONES
            if (!apiKeyInput) {
                alert("⚠️ Error: Debes introducir TU API Key de Gemini.");
                return;
            }
    
            // Guardamos la key en el navegador
            localStorage.setItem('user_gemini_api_key', apiKeyInput);
    
            if (fileInput.files.length === 0) {
                alert("Por favor selecciona un archivo.");
                return;
            }
    
            const file = fileInput.files[0];
            status.textContent = `Preparando ${file.name}...`;
            status.style.color = "#e3b341";
    
            try {
                const base64File = await fileToBase64(file);
                const userPrompt = descInput || "Analiza este archivo y genera el resultado esperado.";
    
                status.textContent = "Enviando a Gemini (esto puede tardar)...";
    
                // URL dinámica con la key del usuario
                const dynamicApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKeyInput}`;
    
                const payload = {
                    contents: [{
                        parts: [
                            { text: `TU ROL: Eres un asistente experto que resuelve ejercicios académicos.
                                    INSTRUCCIÓN: "${userPrompt}".
                                    REGLAS:
                                    1. Analiza el archivo adjunto.
                                    2. Devuelve ÚNICAMENTE el código o texto resultante.
                                    3. NO uses bloques de código markdown (\`\`\`).
                                    4. NO incluyas explicaciones ni saludos.` 
                            },
                            {
                                inline_data: {
                                    mime_type: file.type || "application/pdf", 
                                    data: base64File
                                }
                            }
                        ]
                    }]
                };
    
                const response = await fetch(dynamicApiUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });
    
                const data = await response.json();
    
                if (!response.ok) {
                    console.error("Error API:", data);
                    let msg = data.error?.message || "Error desconocido";
                    if (msg.includes("API key not valid")) {
                        msg = "La API Key introducida no es válida.";
                    } else if (msg.includes("Quota exceeded")) {
                        msg = "Has excedido tu cuota gratuita de Gemini por hoy.";
                    }
                    throw new Error(msg);
                }
    
                let generatedContent = data.candidates?.[0]?.content?.parts?.[0]?.text;
    
                if (!generatedContent) {
                    throw new Error("Gemini no devolvió texto.");
                }
                
                generatedContent = generatedContent.replace(/^```[a-z]*\n/i, '').replace(/```$/, '');
    
                let extension = ".txt";
                const lowerDesc = descInput.toLowerCase();
                if (lowerDesc.includes("sql")) extension = ".sql";
                else if (lowerDesc.includes("python") || lowerDesc.includes("py")) extension = ".py";
                else if (lowerDesc.includes("html")) extension = ".html";
                
                const downloadFilename = "resultado_gemini" + extension;
    
                status.textContent = "¡Éxito! Descargando...";
                status.style.color = "#238636";
    
                const blob = new Blob([generatedContent], { type: "text/plain" });
                const url = URL.createObjectURL(blob);
                const a = document.createElement("a");
                a.href = url;
                a.download = downloadFilename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
    
                setTimeout(() => { toggleModal(false); }, 2000);
    
            } catch (error) {
                console.error(error);
                status.textContent = "Error: " + error.message;
                status.style.color = "#cf222e";
            }
        }
    </script>
  </body>
</html>
